name: Type Check

on:
  push:
  pull_request:

jobs:
  typecheck:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # Install pyenv and build dependencies
      - name: Install pyenv and dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential zlib1g-dev libssl-dev libbz2-dev \
            libreadline-dev libsqlite3-dev libffi-dev liblzma-dev \
            libncurses5-dev libncursesw5-dev libgdbm-dev uuid-dev curl

          curl https://pyenv.run | bash

          # Add pyenv to PATH for this shell
          export PYENV_ROOT="$HOME/.pyenv"
          export PATH="$PYENV_ROOT/bin:$PATH"

      # Install Python versions
      - name: Install Python 3.7.17 and 3.11.9
        run: |
          export PYENV_ROOT="$HOME/.pyenv"
          export PATH="$PYENV_ROOT/bin:$PATH"
          pyenv install -s 3.7.17
          pyenv install -s 3.11.9

      # Run Pyright for Python 3.7
      - name: Run Pyright on Python 3.7
        run: |
          export PYENV_ROOT="$HOME/.pyenv"
          export PATH="$PYENV_ROOT/bin:$PATH"
          pyenv global 3.7.17
          python -m pip install --upgrade pip
          pip install pyright
          pyright --pythonversion 3.7

      # Run Pyright for Python 3.11
      - name: Run Pyright on Python 3.11
        run: |
          export PYENV_ROOT="$HOME/.pyenv"
          export PATH="$PYENV_ROOT/bin:$PATH"
          pyenv global 3.11.9
          python -m pip install --upgrade pip
          pip install pyright
          pyright --pythonversion 3.11
